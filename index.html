<!DOCTYPE html>
<html>

<head>
    <title>firebase-idea</title>
</head>

<body>
    Hello world!
    <input id="userInput" />
    <button id="userBtn">Send User</button>
    <input id="likeInput" />
    <button id="likeBtn">Send Message</button>

    <div id="feed"></div>

    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
    <script>
        var ws;
        var timerID;
        var start = function(websocketServerLocation) {
            if (ws) {
                window.ws.close();
                delete window.ws;
            }
            ws = new WebSocket(websocketServerLocation);
            ws.onopen = function() {
                if (timerID) {
                    window.clearInterval(timerID);
                    timerID = 0;
                }
                $('#feed').append('websocket opened<br>');
            };
            ws.onclose = function() {
                $('#feed').append('<br><br><span class="error">websocket closed</span><br>');
                if (!timerID) {
                    timerID = setInterval(function() {
                        start(websocketServerLocation)
                    }, 2000);
                }
            }

            ws.onmessage = function(m) {
                $('#feed').append(m.data + "<br>");
            };

            $('#userBtn').click(function(){
                ws.send("user: " + $('#userInput').val());
                $('#userInput').val('');
            });

            $('#likeBtn').click(function(){
                ws.send("like: " + $('#likeInput').val());
                $('#likeInput').val('');
            });
        };
        start('ws://' + window.location.hostname + ":8081");
    </script>
</body>

</html>
